---
format: 
  html:
    css: 
      - ../styles.css
      - ../members.css
    page-layout: full
    toc: false
    include-in-header: 
      - text: |
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
          <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">        
---

```{r}
#| results: 'asis'
#| echo: false

library(htmltools)

# Get parameters from the parent document
member <- rmarkdown::metadata

# Helper function to safely get parameter values with defaults
get_param <- function(param_name, default = "") {
  if (is.null(member[[param_name]])) {
    return(default)
  } else {
    return(member[[param_name]])
  }
}

# Extract member information
name <- get_param("name", "Member Name")
position <- get_param("position", "")
photo <- get_param("photo", "default-profile.jpg")
email <- get_param("email", "")
personal_website <- get_param("personal_website", NULL)
faculty_website <- get_param("faculty_website", NULL)
social_media <- get_param("social_media", list())
mission_paragraphs <- get_param("mission_statement", list())
research_interests <- get_param("research_interests", list())
publications <- get_param("publications", list())

# Map platform names to Bootstrap icons
icon_map <- list(
  "bluesky" = "fa-brands fa-bluesky", 
  "linkedin" = "fa-brands fa-linkedin",
  "github" = "fa-brands fa-github",
  "orcid" = "fa-brands fa-orcid",
  "mastodon" = "fa-brands fa-mastodon",
  "scholar" = "fa-solid fa-graduation-cap",
  "researchgate" = "fa-brands fa-researchgate",
  "academia" = "fa-solid fa-book",
  "youtube" = "fa-brands fa-youtube",
  "instagram" = "fa-brands fa-instagram",
  "facebook" = "fa-brands fa-facebook"
)

# Contact items
contact_items <- tagList()
if (email != "") {
  contact_items <- tagAppendChild(contact_items,
    div(class = "contact-item",
      tags$i(class = "bi bi-envelope"),
      a(href = paste0("mailto:", email), email)
    )
  )
}
if (!is.null(personal_website)) {
  contact_items <- tagAppendChild(contact_items,
    div(class = "contact-item",
      tags$i(class = "bi bi-globe"),
      a(href = personal_website, target = "_blank", "Personal Website")
    )
  )
}
if (!is.null(faculty_website)) {
  contact_items <- tagAppendChild(contact_items,
    div(class = "contact-item",
      tags$i(class = "bi bi-globe"),
      a(href = faculty_website, target = "_blank", "Faculty Website")
    )
  )
}

# Social media links
social_links <- NULL
if (length(social_media) > 0) {
  social_links <- div(class = "member-socials",
    lapply(names(social_media), function(platform) {
      platform_lower <- tolower(platform)
      icon <- if (platform_lower %in% names(icon_map)) icon_map[[platform_lower]] else "fa-solid fa-link"
      a(
        href = social_media[[platform]],
        title = platform,
        target = "_blank",
        class = "social-link",
        tags$i(class = icon)
      )
    })
  )
}

# Mission statement
mission_block <- NULL
if (length(mission_paragraphs) > 0) {
  mission_block <- div(class = "member-mission",
    h2("Mission Statement"),
    lapply(mission_paragraphs, function(paragraph) p(paragraph))
  )
}

# Research interests
interests_block <- NULL
if (length(research_interests) > 0) {
  interests_block <- tagList(
    h2("Research Interests"),
    div(class = "interests-container",
      lapply(research_interests, function(interest) {
        div(class = "interest-tag", interest)
      })
    )
  )
}

# Publications
publications_block <- NULL
if (length(publications) > 0) {
  publications_block <- tagList(
    h2("Selected Publications"),
    div(class = "publications-list",
      lapply(publications, function(pub) {
        year <- if (is.null(pub$year)) "" else pub$year
        title <- if (is.null(pub$title)) "" else pub$title
        authors <- if (is.null(pub$authors)) "" else pub$authors
        journal <- if (is.null(pub$journal)) "" else pub$journal
        doi_url <- pub$doi_url
        div(class = "publication-item",
          div(class = "publication-year", year),
          div(class = "publication-content",
            h3(sprintf('"%s"', title)),
            p(class = "publication-authors", authors),
            p(class = "publication-journal", tags$em(journal)),
            if (!is.null(doi_url)) {
              div(class = "publication-links",
                a(href = doi_url, class = "pub-link", tags$i(class = "bi bi-box-arrow-up-right"), " DOI")
              )
            }
          )
        )
      })
    )
  )
}

# Compose the full profile
profile <- div(class = "member-profile",
  div(class = "member-header",
    div(class = "member-photo",
      img(src = photo)
    ),
    div(class = "member-info",
      h1(name),
      p(class = "member-position", position),
      div(class = "member-contact", contact_items, social_links)
    )
  ),
  mission_block,
  div(class = "member-content",
    interests_block,
    publications_block
  )
)

# Render the profile
browsable(profile)
```